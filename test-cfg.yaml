#-------------------------------------------------------------------------------
#
# SDK Jenkins Pipeline Configuration
#
# Copyright (C) 2022, HENSOLDT Cyber GmbH
#
#-------------------------------------------------------------------------------

# Format for test configurations:
#
# <system name>
#   flags: [BUILD, TEST, SDK_DEMO]
#   testSystem: <repo>
#   testScript: <name, defaults to <system name>.py >
#   buildParams:
#   - -D TEST_CONFIGURATION=<target>
#   testParams:
#   - --tc=platform.test_configuration:<target>"
#   platforms: # can be a simple array or a map
#     <name1>:
#     <name2>:
#       addFlags: [BUILD, TEST, SDK_DEMO]
#       buildParams: <array>
#       testParams: <array>


#-------------------------------------------------------------------------------
# Fundamental Demo Systems, required for the SDK package sanity check
#-------------------------------------------------------------------------------

demo_hello_world:
  flags: [BUILD, SDK_DEMO]
  testScript: test_demo_hello_world.py
  platforms:
    zynq7000:
      addFlags: TEST
    sabre:
      addFlags: TEST
    zynqmp:
      addFlags: TEST
    hifive:
      addFlags: TEST
    spike64:
      addFlags: TEST
    rpi3:
    rpi4:
    nitrogen6sx:
    spike32:


#-------------------------------------------------------------------------------
# Additional Official Demo System
#-------------------------------------------------------------------------------

demo_iot_app:
  flags: [BUILD, SDK_DEMO]
  testScript: test_demo_iot_app.py
  platforms:
    zynq7000:
      addFlags: TEST
    zynqmp:

demo_iot_app_imx6:
  flags: [BUILD, SDK_DEMO]
  platforms: [sabre, nitrogen6sx]

demo_iot_app_rpi3:
  flags: [BUILD, SDK_DEMO]
  platforms: [rpi3]

demo_tls_api:
  flags: [BUILD, SDK_DEMO]
  testScript: test_demo_tls_api.py
  platforms:
    zynq7000:
      addFlags: TEST
    sabre:
      addFlags: TEST
    nitrogen6sx:
    rpi3:

demo_network_filter:
  flags: [BUILD, SDK_DEMO]
  platforms: [zynq7000, nitrogen6sx]

#-------------------------------------------------------------------------------
# Unofficial Demo Systems
#-------------------------------------------------------------------------------

demo_i2c:
  flags: [BUILD]
  platforms: [sabre]

demo_tls_server:
  flags: [BUILD]
  platforms: [zynq7000]

# This test was used during porting the RPi Ethernet driver only. The RasPi3
# Socket API of this test needs to be adapted to the recent changes. But this
# test system is to be deleted anyway, once it's confirmed that all relevant
# parts were integrated into test_network_api.
#
#   demo_raspi_ethernet:
#     flags: [BUILD]
#     platforms: [rpi3]

#------------------------------------------------------------------------------
# Test Systems
#
# Testing ZynqMP requires using the test container trentos_test:20210316
# which contains the Xilinx QEMU.
#------------------------------------------------------------------------------

test_timeserver:
  flags: [BUILD]
  platforms:
    zynq7000:
      addFlags: TEST
    sabre:
      addFlags: TEST
    hifive:
      addFlags: TEST
    zynqmp: # test still fails
    rpi3:
    rpi4:

test_certserver:
  flags: [BUILD]
  platforms:
    zynq7000:
      addFlags: TEST
    sabre:
      addFlags: TEST
    rpi3:
    zynqmp:

test_uart:
  flags: [BUILD]
  platforms:
    zynq7000:
      addFlags: TEST
    sabre:
      addFlags: TEST
    zynqmp:
      addFlags: TEST
    hifive:
      addFlags: TEST

test_chanmux:
  flags: [BUILD]
  platforms:
    zynq7000:
      addFlags: TEST
    zynqmp:

test_proxy_nvm:
  flags: [BUILD]
  platforms:
    zynq7000:
      addFlags: TEST
    zynqmp:

test_certparser:
  flags: [BUILD]
  platforms:
    zynq7000:
      addFlags: TEST
    zynqmp:

test_crypto_api:
  flags: [BUILD]
  platforms:
    zynq7000:
      addFlags: TEST
    zynqmp:
      addFlags: TEST
    hifive:
      addFlags: TEST
    spike64:
      addFlags: TEST

test_cryptoserver:
  flags: [BUILD]
  platforms:
    zynq7000:
      addFlags: TEST
    zynqmp:

test_entropysource:
  flags: [BUILD]
  platforms:
    zynq7000:
      addFlags: TEST
    zynqmp:

test_storage_interface:
  flags: [BUILD]
  testScript: test_storage_interface*.py
  platforms:
    zynq7000:
      addFlags: TEST
    sabre:
      addFlags: TEST
    rpi3:
    rpi4:

test_filesystem:
  flags: [BUILD]
  platforms:
    zynq7000:
      addFlags: TEST
    zynqmp:

test_config_server:
  flags: [BUILD]
  platforms:
    zynq7000:
      addFlags: TEST
    zynqmp:

test_keystore:
  flags: [BUILD]
  platforms:
    zynq7000:
      addFlags: TEST
    zynqmp:

test_logserver:
  flags: [BUILD]
  platforms:
    zynq7000:
      addFlags: TEST
    zynqmp:

test_tls_api:
  flags: [BUILD]
  platforms:
    zynq7000:
      addFlags: TEST
    sabre:
    nitrogen6sx:
    rpi3:

test_tlsserver:
  flags: [BUILD]
  platforms:
    zynq7000:
      addFlags: TEST
    sabre:
    nitrogen6sx:
    rpi3:

test_network_api_tcp_client_single_socket:
  flags: [BUILD, TEST]
  testScript: test_network_api.py
  testSystem: ss/test_network_api
  buildParams: -D TEST_CONFIGURATION=tcp_client_single_socket
  testParams: --tc=platform.test_configuration:tcp_client_single_socket
  platforms: [zynq7000, sabre]

test_network_api_tcp_client_multiple_sockets:
  flags: [BUILD, TEST]
  testScript: test_network_api.py
  testSystem: ss/test_network_api
  buildParams: -D TEST_CONFIGURATION=tcp_client_multiple_sockets
  testParams: --tc=platform.test_configuration:tcp_client_multiple_sockets
  platforms: [zynq7000, sabre]

test_network_api_tcp_client_multiple_clients:
  flags: [BUILD, TEST]
  testScript: test_network_api.py
  testSystem: ss/test_network_api
  buildParams: -D TEST_CONFIGURATION=tcp_client_multiple_clients
  testParams: --tc=platform.test_configuration:tcp_client_multiple_clients
  platforms: [zynq7000, sabre]

test_network_api_tcp_server:
  flags: [BUILD]
  testScript: test_network_api.py
  testSystem: ss/test_network_api
  buildParams: -D TEST_CONFIGURATION=tcp_server
  testParams: --tc=platform.test_configuration:tcp_server
  platforms:
    zynq7000:
      addFlags: TEST
    sabre:
      addFlags: TEST
    nitrogen6sx:
    rpi3:

test_network_api_udp_server:
  flags: [BUILD, TEST]
  testScript: test_network_api.py
  testSystem: ss/test_network_api
  buildParams: -D TEST_CONFIGURATION=udp_server
  testParams: --tc=platform.test_configuration:udp_server
  platforms: [zynq7000, sabre]
